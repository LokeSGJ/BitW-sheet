<div class="preload"><img src="https://i.imgur.com/ZBGj0Mb.png" /><img
  src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/teeth/xptooth-white.png" /><img
  src="https://i.imgur.com/fFBEhsz.png" /><img
  src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/teeth/stresstooth-black.png" /><img
  src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/teeth/stresstooth-halfgrey.png" /><img
  src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/teeth/stresstooth-white.png" /><img
  src="https://i.imgur.com/SF6wbwp.png" /><img
  src="https://raw.githubusercontent.com/Roll20/roll20-character-sheets/master/Blades%20in%20the%20Dark/Assets/teeth/shorttooth-grey.png" />
</div><input class="focus-shadow" type="hidden" name="attr_setting_focus_shadow" value="1" /><input
class="show-broadcast" type="hidden" name="attr_setting_show_broadcast" value="1" /><input class="show-itemdesc"
type="hidden" name="attr_setting_show_itemdesc" value="1" /><input class="use-kirsty" type="hidden"
name="attr_setting_usekirsty" value="0" /><input class="flexwidth" type="hidden" name="attr_setting_flexwidth"
value="0" /><input type="hidden" name="attr_changed_attributes" value="" /><input type="hidden" name="attr_bonusdice"
value="Bonus dice" /><input type="hidden" name="attr_numberofdice"
value=" {{?{Number of dice|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]}}}" /><input
type="hidden" name="attr_notes_query" value="?{Notes}" /><input type="hidden" name="attr_position_query"
value="?{Position|Risky,position=Risky|Controlled,position=Controlled|Desperate,position=Desperate|Fortune roll,position=}" /><input
type="hidden" name="attr_effect_query" value="?{Effect|Standard|Limited|Great|Extreme|Zero}" /><input type="hidden"
name="attr_consequence_query" value="^{a_consequence}" /><input type="hidden" name="attr_stress_max"
value="12" /><input type="hidden" name="attr_trauma_max" value="3" /><input type="hidden" name="attr_coin_max"
value="4" /><input type="hidden" name="attr_stash_max" value="40" /><input type="hidden" name="attr_playbook_xp_max"
value="8" /><input type="hidden" name="attr_rep_max" value="12" /><input type="hidden" name="attr_turf_max"
value="6" /><input type="hidden" name="attr_crew_tier_max" value="4" /><input type="hidden" name="attr_heat_max"
value="9" /><input type="hidden" name="attr_wanted_max" value="4" /><input type="hidden" name="attr_crewcoin_max"
value="16" /><input type="hidden" name="attr_crew_xp_max" value="8" />
<div class="container"><input class="type" type="hidden" name="attr_sheet_type" value="character" />
<!-- Title & Version-->
<div class="topholder flex">
  <!-- Toggle the type of sheet-->

  <label class="settings-checkbox">
    <input type="checkbox" name="attr_show_settings" value="1" /><span>y</span>
  </label>
  <div class="version"><span class="version-text" data-i18n="version"></span><span name="attr_version"></span></div>
</div>
<input class="hider" type="hidden" name="attr_show_settings" value="0" />
<!-- Settings-->
<div class="settings flex-wrap">
  <div class="setting-char generaterow">
    <select name="attr_generate_source_character" title="Choose source">
    </select>
    <label class="generatebutton">
      <input type="checkbox" name="attr_generate_ability" value="1" /><span data-i18n="add_abilities"></span>
    </label>
    <label class="generatebutton">
      <input type="checkbox" name="attr_generate_friend" value="1" /><span data-i18n="add_friends"></span>
    </label>
    <label class="generatebutton">
      <input type="checkbox" name="attr_generate_playbookitem" value="1" /><span data-i18n="add_items"></span>
    </label>
  </div>
  <div class="setting-crew generaterow">
    <select name="attr_generate_source_crew" title="Choose source">
    </select>
    <label class="generatebutton">
      <input type="checkbox" name="attr_generate_crewability" value="1" /><span data-i18n="add_abilities"></span>
    </label>
    <label class="generatebutton">
      <input type="checkbox" name="attr_generate_contact" value="1" /><span data-i18n="add_contacts"></span>
    </label>
    <label class="generatebutton">
      <input type="checkbox" name="attr_generate_upgrade" value="1" /><span data-i18n="add_upgrades"></span>
    </label>
  </div>
  <div class="setting-char"><label><input type="text" spellcheck="false" name="attr_setting_stress_label"
    value="Fatigue" /><span data-i18n="stress_label"></span></label></div>
  <div class="setting-faction generaterow">
    <label class="generatebutton">
      <input type="checkbox" name="attr_generate_factions" value="1" /><span data-i18n="generate_factions"></span>
    </label>
  </div>
  <div class="setting-char">
    <label>
      <select name="attr_setting_extra_stress" title="Total Fatigue Boxes">
        <option value="0" selected="selected">7</option>
        <option value="1">8</option>
        <option value="2">9</option>
        <option value="3">10</option>
      </select><span data-i18n="number_stress_boxes"></span>
    </label>
  </div>
  <div class="setting-char setting-crew">
    <label>
      <input class="checkbox squarebox" type="checkbox" name="attr_setting_extra_xp1" value="1" /><span></span><span
        data-i18n="show_extra_xp_condition1"></span>
    </label>
  </div>
  <div class="setting-char setting-crew">
    <label>
      <input class="checkbox squarebox" type="checkbox" name="attr_setting_extra_xp2" value="1" /><span></span><span
        data-i18n="show_extra_xp_condition2"></span>
    </label>
  </div>
  <div class="setting-char">
      <label>
        <input class="checkbox squarebox" type="checkbox" name="attr_setting_extra_trauma"
          value="1" /><span></span><span data-i18n="show_extra_trauma_box"></span>
      </label>
    </div>
  <div class="setting-char setting-crew">
    <label>
      <input class="checkbox squarebox" type="checkbox" name="attr_setting_show_itemdesc" value="1"
        checked="checked" /><span></span><span data-i18n="show_item_description"></span>
    </label>
  </div>
  <div class="setting-char">
    <label>
      <input class="checkbox squarebox" type="checkbox" name="attr_setting_show_cohort" value="1" /><span></span><span
        data-i18n="show_cohort_section"></span>
    </label>
  </div>
  <div class="setting-char"><span data-i18n="resistance_bonus"></span>
    <label>
      <input type="number" name="attr_setting_resbonus_insight" value="0" /><span data-i18n="insight"></span>
    </label>
    <label>
      <input type="number" name="attr_setting_resbonus_prowess" value="0" /><span data-i18n="prowess"></span>
    </label>
    <label>
      <input type="number" name="attr_setting_resbonus_resolve" value="0" /><span data-i18n="resolve"></span>
    </label>
  </div>
  <div class="setting-char">
    <label>
      <input class="checkbox squarebox" type="checkbox" name="attr_setting_consequence_query"
        value="1" /><span></span><span data-i18n="query_for_consequence"></span>
    </label>
  </div>
  <div class="setting-char"><span data-i18n="load:"></span>
    <label>
      <input type="number" name="attr_setting_load_l" value="6" /><span data-i18n="light"></span>
    </label>
    <label>
      <input type="number" name="attr_setting_load_n" value="6" /><span data-i18n="normal"></span>
    </label>
    <label>
      <input type="number" name="attr_setting_load_h" value="6" /><span data-i18n="heavy"></span>
    </label>
  </div>
  <div class="setting-char setting-crew setting-faction">
    <label>
      <input class="checkbox squarebox" type="checkbox" name="attr_setting_flexwidth" value="1" /><span></span><span
        data-i18n="flexible_width"></span>
    </label>
  </div>
  <div class="setting-char setting-crew setting-faction">
    <label>
      <input class="checkbox squarebox" type="checkbox" name="attr_setting_focus_shadow" value="1"
        checked="checked" /><span></span><span data-i18n="show_outline"></span>
    </label>
  </div>
  <div class="setting-char setting-crew setting-faction">
    <label>
      <input class="checkbox squarebox" type="checkbox" name="attr_setting_show_broadcast" value="1"
        checked="checked" /><span></span><span data-i18n="show_broadcast"></span>
    </label>
  </div>
  <div class="setting-char setting-crew">
    <label>
      <input class="checkbox squarebox" type="checkbox" name="attr_setting_autofill" value="1"
        checked="checked" /><span></span><span data-i18n="fill_fields"></span>
    </label>
  </div>
  <div class="setting-char setting-crew">
    <input class="wide" type="text" spellcheck="false" name="attr_chat_image" value="" /><span
      data-i18n="chat_image"></span>
  </div>
  <div class="setting-char setting-crew setting-faction kirsty-option">
    <label>
      <input class="checkbox squarebox" type="checkbox" name="attr_setting_usekirsty" value="1" /><span></span><span
        data-i18n="use_kirsty"></span>
    </label>
  </div>
  <div class="setting-faction">
    <label>
      <input class="checkbox squarebox" type="checkbox" name="attr_setting_clocks_only" value="1" /><span></span><span
        data-i18n="clocks_only"></span>
    </label>
  </div>
</div>
<!-- Character Sheet-->
<div class="type-character flex">
  <!-- Left column-->
  <div class="col55 flex-wrap">
    <!-- Logo, Header text fields-->
    <div class="col100 header flex">
      <div class="col80 bladeslogo"></div>

      <label class="col100"><input type="text" spellcheck="false" name="attr_name" />
        <div class="label text title" data-i18n="name"></div>
      </label>

      <label class="col100">
        <input type="text" spellcheck="false" name="attr_look" />
        <div class="label text title" data-i18n="look"></div>
      </label>
      <label class="col100">
        <div class="auto-expand"><span name="attr_heritage"></span>
          <textarea spellcheck="false" name="attr_heritage"></textarea>
        </div>
        <input type="hidden" name="attr_heritage" value="" />
        <div class="text"><span class="label title" data-i18n="heritage"></span><span class="uppercase info"
            data-i18n="heritage_info"></span></div>
      </label>

      <label class="col100 vice normal">
        <div class="auto-expand"><span name="attr_vice_purveyor"></span>
          <textarea spellcheck="false" name="attr_vice_purveyor"></textarea>
        </div>
        <input type="hidden" name="attr_vice_purveyor" value="" />
        <div class="text"><span class="label title" data-i18n="vice_purveyor"></span></div>

        <button class="vicebutton borderbutton" type="roll" name="roll_Vice"
          value="&{template:bitd} {{charname=@{character_name}}} {{subtitle=^{viceroll1}@{stress}&nbsp;@{setting_stress_label}^{viceroll2}}} {{vice=1}} {{title=^{vice}}} @{vice_formula} {{charimage=@{chat_image}}}"
          data-i18n="indulge_vice"></button>
        <input type="hidden" name="attr_vice_formula"
          value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
      </label>
    </div>
    <!-- Stress and Trauma-->
    <div class="col100 flex stress def-margin">
      <!-- Stress markers-->
      <div class="stress1 blackheader">
        <div class="label" data-i18n="stress"></div>
      </div>
      <div class="stress2 blackborder flex">
        <input class="tooth zero" type="radio" name="attr_stress" value="0" checked="checked" /><span></span>
        <input class="tooth stresstooth" type="radio" name="attr_stress" value="1" /><span></span>
        <input class="tooth stresstooth" type="radio" name="attr_stress" value="2" /><span></span>
        <input class="tooth stresstooth" type="radio" name="attr_stress" value="3" /><span></span>
        <input class="tooth stresstooth" type="radio" name="attr_stress" value="4" /><span></span>
        <input class="tooth stresstooth" type="radio" name="attr_stress" value="5" /><span></span>
        <input class="tooth stresstooth" type="radio" name="attr_stress" value="6" /><span></span>
        <input class="hidden extra-teeth" type="checkbox" name="attr_setting_extra_stress" value="0"
          checked="checked" />
        <input class="tooth stresstooth" type="radio" name="attr_stress" value="7" /><span></span>
        <input class="hidden extra-teeth" type="checkbox" name="attr_setting_extra_stress" value="1" />
        <input class="tooth stresstooth" type="radio" name="attr_stress" value="8" /><span></span>
        <input class="hidden extra-teeth" type="checkbox" name="attr_setting_extra_stress" value="2" />
        <input class="tooth stresstooth" type="radio" name="attr_stress" value="9" /><span></span>
        <input class="hidden extra-teeth" type="checkbox" name="attr_setting_extra_stress" value="3" />
        <input class="tooth stresstooth" type="radio" name="attr_stress" value="10" /><span></span>
      </div>
      <!-- Trauma markers-->
      <div class="stress3">
        <div class="blackheader">
          <div class="label" data-i18n="trauma"></div>
        </div>
        <div class="traumaholder flex">
          <input class="tooth zero" type="radio" name="attr_trauma" value="0" checked="checked" /><span></span>
          <input class="tooth regulartooth" type="radio" name="attr_trauma" value="1" /><span></span>
          <input class="tooth regulartooth" type="radio" name="attr_trauma" value="2" /><span></span>
          <input class="hidden extra-teeth" type="checkbox" name="attr_setting_extra_trauma" value="0" checked="checked"/>
          <input class="tooth regulartooth" type="radio" name="attr_trauma" value="3" /><span></span>
          <input class="hidden extra-teeth" type="checkbox" name="attr_setting_extra_trauma" value="1"/>
          <input class="tooth regulartooth" type="radio" name="attr_trauma" value="4" /><span></span>
          <!--<input class="tooth regulartooth" type="radio" name="attr_trauma" value="5" /><span></span>-->
        </div>
      </div>
      <!-- Individual traumata-->
      <div class="stress4 blackborder">
        <div>
          <div class="flex">
            <label class="text-button">
              <input type="checkbox" name="attr_trauma_cold" value="1" /><span data-i18n="cold"></span>
            </label><span>—</span>
            <label class="text-button">
              <input type="checkbox" name="attr_trauma_haunted" value="1" /><span data-i18n="haunted"></span>
            </label><span>—</span>
            <label class="text-button">
              <input type="checkbox" name="attr_trauma_obsessed" value="1" /><span data-i18n="obsessed"></span>
            </label>
            <!--Trauma 4 removed
            <label class="text-button">
              <input type="checkbox" name="attr_trauma_paranoid" value="1" /><span data-i18n="paranoid"></span>
            </label>-->
          </div>
          <!--Traumas 5-7 (8 isn't here at all) removed-->
          <!--<div class="flex">
            <label class="text-button">
              <input type="checkbox" name="attr_trauma_reckless" value="1" /><span data-i18n="reckless"></span>
            </label><span>—</span>
            <label class="text-button">
              <input type="checkbox" name="attr_trauma_soft" value="1" /><span data-i18n="soft"></span>
            </label><span>—</span>
            <label class="text-button">
              <input type="checkbox" name="attr_trauma_unstable" value="1" /><span data-i18n="unstable"></span>
            </label>

          </div>-->
        </div>
      </div>
    </div>
    <!-- Harm, Healing, Armor, Coin-->
    <div class="col100 flex def-margin">
      <!-- Harm-->
      <div class="harm col63">
        <div class="blackheader col100">
          <div class="label" data-i18n="harm"></div>
          <button class="broadcast-button" type="roll" name="roll_Harm"
            value="&{template:bitd-broadcast} {{charname=@{character_name}}} {{harm=1}} {{harm3=@{harm3}}} {{harm2_1=@{harm2_1}}} {{harm2_2=@{harm2_2}}} {{harm1_1=@{harm1_1}}} {{harm1_2=@{harm1_2}}} {{charimage=@{chat_image}}}"
            data-i18n-title="send_details_to_chat">:</button>
        </div>
        <div class="harmbody">
          <div class="flex-center harmnumber">3</div>
          <textarea class="twocols" spellcheck="false" name="attr_harm3"></textarea>
          <div class="flex-center harmeffect" data-i18n="need_help"></div>
          <div class="flex-center harmnumber">2</div>
          <textarea spellcheck="false" name="attr_harm2_1"></textarea>
          <textarea spellcheck="false" name="attr_harm2_2"></textarea>
          <div class="flex-center harmeffect" data-i18n="minus1d"></div>
          <div class="flex-center harmnumber">1</div>
          <textarea spellcheck="false" name="attr_harm1_1"></textarea>
          <textarea spellcheck="false" name="attr_harm1_2"></textarea>
          <div class="flex-center harmeffect" data-i18n="less_effect"></div>
        </div>
      </div>
      <!-- Armor, Healing and Coin-->
      <div class="col37 flex-wrap">
        <!-- Healing-->

        <!-- Healing clock-->

        <!-- Armor-->
        <div class="armor col100">
          <div class="blackheader col100">
            <div class="label" data-i18n="armor_uses"></div>
          </div>




          <label>
            <input class="checkbox squarebox" type="checkbox" name="attr_hope" value="1" /><span></span><span
              class="label" data-i18n="hope" data-i18n-title="hope_description" style="padding: 0 12px 0 0;"></span>
          </label>
          <label>
            <input class="checkbox squarebox" type="checkbox" name="attr_armor" value="1" /><span></span><span
              class="label" data-i18n="armor" style="padding: 0 12px 0 0;"></span>
          </label>
          <label>
            <input class="checkbox squarebox" type="checkbox" name="attr_heavy" value="1" /><span></span><span
              class="label" data-i18n="heavy" style="padding: 0 12px 0 0;"></span>
          </label>
          <label>
            <input class="checkbox squarebox" type="checkbox" name="attr_special" value="1" /><span></span><span
              class="label" data-i18n="special" style="padding: 0 12px 0 0;"></span>
          </label>
          <label>
            <input class="checkbox squarebox" type="checkbox" name="attr_shield" value="1" /><span></span><span
              class="label" data-i18n="shield" style="padding: 0 12px 0 0;"></span>
          </label>


          <label>
            <span style="font-weight: bold; font-size: 11px; margin: 8px 0 0 0;">SILVER</span>
          </label>
        </div>
        <!-- Coin and Stash-->
        <div class="col100 coin-and-stash" style="margin: 8px 0 0 0;">
          <!-- Coin-->
          <div class="col100 coinrow flex">
            <div class="coin flex">
              <input class="zero" type="radio" name="attr_coin" value="0" checked="checked" /><span></span>
              <input class="radiobox" type="radio" name="attr_coin" value="1" /><span></span>
              <input class="radiobox" type="radio" name="attr_coin" value="2" /><span></span>
              <input class="radiobox" type="radio" name="attr_coin" value="3" /><span></span>
              <input class="radiobox" type="radio" name="attr_coin" value="4" /><span></span>
              <input class="radiobox" type="radio" name="attr_coin" value="5" /><span></span>
              <input class="radiobox" type="radio" name="attr_coin" value="6" /><span></span>
              <input class="radiobox" type="radio" name="attr_coin" value="7" /><span></span>
              <input class="radiobox" type="radio" name="attr_coin" value="8" /><span></span>
              <input class="radiobox" type="radio" name="attr_coin" value="9" /><span></span>
              <input class="radiobox" type="radio" name="attr_coin" value="10" /><span></span>
            </div>

          </div>
          <!-- Stash-->

        </div>
      </div>
    </div>
    <!-- Unique action-->
    <!--<div class="col100 def-margin">
      <div class="specialheader col100 label" data-i18n="unique_action"
        style="background-color:rgb(0, 0, 0); color:white;"></div>
      <div class="greyholder col100" style="background-color:white;">


        <div class="playbookitems col100 free-repcontrol">
          <fieldset class="repeating_upgrade"><input class="boxes-chosen" type="hidden" name="attr_boxes_chosen"
              value="0" />
            <div class="item numboxes-chooser">
              <div data-i18n="how_many_boxes"></div><input type="number" name="attr_numboxes" min="1" max="3"
                value="1" /><label><input type="checkbox" name="attr_boxes_chosen" value="0" /><span
                  data-i18n="ok"></span></label>
            </div>
            <div class="item"><input class="numboxes" type="hidden" name="attr_numboxes" value="1" /><input
                class="checkbox squarebox" type="checkbox" name="attr_check_1" value="1" /><span></span><span
                class="floatingbar boxesgeq2"></span><input class="checkbox squarebox boxesgeq2" type="checkbox"
                name="attr_check_2" value="1" /><span class="boxesgeq2"></span><span
                class="floatingbar boxesgeq3 boxesgeq2"></span><input class="checkbox squarebox boxesgeq2 boxesgeq3"
                type="checkbox" name="attr_check_3" value="1" /><span class="boxesgeq2 boxesgeq3"></span>
              <div class="auto-expand abilityname smallcaps"><span></span>
                <textarea spellcheck="false" data-i18n-placeholder="ability_name"></textarea>
              </div>
              <div class="auto-expand abilitydesc"><span name="attr_description"></span>
                <textarea spellcheck="false" name="attr_description"
                  data-i18n-placeholder="ability_description"></textarea>
              </div>
            </div>
          </fieldset>
        </div>


      </div>
    </div> -->
    <!-- another unique action -->
    <div class="col100 itemholder def-margin">
      <div class="specialheader col100 label" data-i18n="unique_action"
        style="background-color:rgb(0, 0, 0); color:white;"></div>
      
      <fieldset class="repeating_upgrade"><input class="boxes-chosen" type="hidden"
              name="attr_boxes_chosen" value="0" />
          <div class="item numboxes-chooser">
              <div data-i18n="how_many_boxes"></div><input type="number" name="attr_numboxes" min="1"
                  max="3" value="1" /><label><input type="checkbox" name="attr_boxes_chosen"
                      value="1" /><span data-i18n="ok"></span></label>
          </div>
          <div class="item"><input class="numboxes" type="hidden" name="attr_numboxes"
                  value="1" /><input class="checkbox squarebox" type="checkbox" name="attr_check_1"
                  value="1" /><span></span><span class="floatingbar boxesgeq2"></span><input
                  class="checkbox squarebox boxesgeq2" type="checkbox" name="attr_check_2"
                  value="1" /><span class="boxesgeq2"></span><span
                  class="floatingbar boxesgeq3 boxesgeq2"></span><input
                  class="checkbox squarebox boxesgeq2 boxesgeq3" type="checkbox" name="attr_check_3"
                  value="1" /><span class="boxesgeq2 boxesgeq3"></span>
              <div class="auto-expand itemname smallcaps"  style="font-size: 16px"><span name="attr_name"></span><textarea
                      spellcheck="false" name="attr_name"
                      data-i18n-placeholder="an_upgrade"></textarea></div>
          </div>
          <div class="item-description"><input class="expand" type="checkbox" name="attr_expand"
                  value="1" /><span></span><textarea spellcheck="false" name="attr_description"
                  data-i18n-placeholder="description" style="font-size: 13px"></textarea></div>
      </fieldset>
  </div>

    <!-- Special abilities-->
    <div class="col100 def-margin">
      <div class="specialheader col100 label" data-i18n="special_abilities"></div>
      <div class="greyholder col100">
        <fieldset class="repeating_ability">
          <div class="specialability flex">
            <button class="broadcast-button" type="roll" name="roll_Show"
              value="&{template:bitd-broadcast} {{charname=@{character_name}}} {{type=^{special_ability}}} {{title=@{name}}} {{content=@{description}}} {{charimage=@{chat_image}}}"
              data-i18n-title="send_details_to_chat">:</button>
            <input class="checkbox circlebox" type="checkbox" name="attr_check" value="1" /><span></span>
            <div class="auto-expand abilityname smallcaps"><span name="attr_name"></span>
              <textarea spellcheck="false" name="attr_name" data-i18n-placeholder="ability_name"></textarea>
            </div>
            <div class="auto-expand abilitydesc"><span name="attr_description"></span>
              <textarea spellcheck="false" name="attr_description"
                data-i18n-placeholder="ability_description"></textarea>
            </div>
          </div>
        </fieldset>
      </div>
    </div>
    <!-- Advancement-->
    <div class="col100 def-margin">
      <div class="advancement-header flex blackheader">
        <div class="label markxp" data-i18n="mark_xp:"></div>
        <div class="label" data-i18n="playbook_advancement"></div>
        <div class="xpholder flex">
          <input class="tooth zero" type="radio" name="attr_playbook_xp" value="0" checked="checked" /><span></span>
          <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="1" /><span></span>
          <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="2" /><span></span>
          <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="3" /><span></span>
          <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="4" /><span></span>
          <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="5" /><span></span>
          <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="6" /><span></span>
          <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="7" /><span></span>
          <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="8" /><span></span>
          <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="9" /><span></span>
          <input class="tooth xptooth" type="radio" name="attr_playbook_xp" value="10" /><span></span>
        </div>
      </div>
      <ul class="advancement-desc">
          <li data-i18n="xp_desperate"></li>
          <li class="nondot" data-i18n="xp_top"></li>
          <li>
              <div class="auto-expand">
                  <span name="attr_xp_condition1"></span>
                  <textarea spellcheck="false" name="attr_xp_condition1" data-i18n-placeholder="xp_good"></textarea>
              </div>
          </li>
          <li>
              <div class="auto-expand">
                  <span name="attr_xp_condition2"></span>
                  <textarea spellcheck="false" name="attr_xp_condition2" data-i18n-placeholder="xp_discover"></textarea>
              </div>
          </li>
          <li>
              <div class="auto-expand">
                  <span name="attr_xp_condition3"></span>
                  <textarea spellcheck="false" name="attr_xp_condition3" data-i18n-placeholder="xp_beliefs"></textarea>
              </div>
          </li>
          <li>
            <div class="auto-expand">
                <span name="attr_xp_condition4"></span>
                <textarea spellcheck="false" name="attr_xp_condition4" data-i18n-placeholder="xp_moment"></textarea>
            </div>
        </li>

          <input class="hider" type="hidden" name="attr_setting_extra_xp1" value="0" />
          <li>
              <div class="auto-expand">
                  <span name="attr_xp_condition_extra1"></span>
                  <textarea spellcheck="false" name="attr_xp_condition_extra1" data-i18n-placeholder="xp_custom"></textarea>
              </div>
          </li>

          <input class="hider" type="hidden" name="attr_setting_extra_xp2" value="0" />
          <li>
              <div class="auto-expand">
                  <span name="attr_xp_condition_extra2"></span>
                  <textarea spellcheck="false" name="attr_xp_condition_extra2" data-i18n-placeholder="xp_custom"></textarea>
              </div>
          </li>
      </ul>
    </div>
    <!-- Teamwork-->

  </div>
  <!-- Right column-->
  <div class="col45 flex-wrap right-column">
    <!-- Playbook name and description-->
    <div class="playbook flex">
      <input class="label" type="text" spellcheck="false" name="attr_playbook" data-i18n-placeholder="playbook" />
      <textarea class="label" spellcheck="false" name="attr_playbook_description"
        data-i18n-placeholder="playbook_description"></textarea>
      <input class="hider" type="hidden" name="attr_show_playbook_reminder" value="1" />
      <div class="reminder"><span data-i18n="autofill_reminder_playbook"></span><br /><span
          data-i18n="list_playbooks"></span></div>
    </div>
    <!-- Items and Planning-->
    <div class="col53 itemcolumn small-margin">
      <!-- Load-->
      <div class="loadheader flex col100">
        <div class="label" data-i18n="load" style="font-weight: bold"></div>
        <label>
          <span></span><span class="loadnumber" name="attr_setting_load_l"></span><span data-i18n="light"></span>
        </label>

      </div>
      <div class="itemheader small-margin col100 flex">
        <div class="label" data-i18n="items"></div><span class="italic" data-i18n="italics_dont_count"></span>

      </div>
      <!-- Items-->
      <div class="itemholder col100 items">
        <!-- Playbook items-->
        <div class="playbookitems col100 free-repcontrol">
          <fieldset class="repeating_playbookitem">
            <input class="boxes-chosen" type="hidden" name="attr_boxes_chosen" value="0" />
            <div class="item numboxes-chooser">
              <div data-i18n="how_much_load"></div>
              <input type="number" name="attr_numboxes" min="0" max="3" value="0" />
              <label>
                <input type="checkbox" name="attr_bold" value="1" /><span data-i18n="bold"></span>
              </label>
              <label>
                <input type="checkbox" name="attr_boxes_chosen" value="1" /><span data-i18n="ok"></span>
              </label>
            </div>
            <div class="item">
              <input class="input-bold" type="hidden" name="attr_bold" value="0" />
              <input class="numboxes" type="hidden" name="attr_numboxes" value="0" />
              <input class="checkbox squarebox" type="checkbox" name="attr_check_1" value="1" /><span></span><span
                class="floatingbar boxesgeq2"></span>
              <input class="checkbox squarebox boxesgeq2" type="checkbox" name="attr_check_2" value="1" /><span
                class="boxesgeq2"></span><span class="floatingbar boxesgeq3 boxesgeq2"></span>
              <input class="checkbox squarebox boxesgeq2 boxesgeq3" type="checkbox" name="attr_check_3"
                value="1" /><span class="boxesgeq2 boxesgeq3"></span>
              <div class="auto-expand itemname"><span name="attr_name"></span>
                <textarea spellcheck="false" name="attr_name" data-i18n-placeholder="item_name"></textarea>
              </div>
            </div>
            <div class="item-description">
              <input class="expand" type="checkbox" name="attr_expand" value="1" /><span></span>
              <textarea spellcheck="false" name="attr_description" data-i18n-placeholder="description"></textarea>
            </div>
          </fieldset>
        </div>
        <!-- Regular items-->
        <div class="loadheader flex col100" style="margin-top: 5px">
          <div class="label" data-i18n="supplies"></div>
          
        </div>
        
        <div class="regularitems col100 free-repcontrol free-repcontrol" style="background-color:#D8D8D8">
          
          <p>At the start of a quest, choose 2:</p>


          <fieldset class="repeating_item">
            <input class="input-short" type="hidden" name="attr_short" value="0" />
            <input class="input-expand" type="hidden" name="attr_expand" value="0" />
            <div class="item-container">
              <input class="boxes-chosen" type="hidden" name="attr_boxes_chosen" value="0" />
              <div class="item numboxes-chooser">
                <div data-i18n="how_much_load"></div>
                <input type="number" name="attr_numboxes" min="0" max="3" value="0" />
                <label>
                  <input type="checkbox" name="attr_short" value="1" /><span data-i18n="short"></span>
                </label>
                <label>
                  <input type="checkbox" name="attr_boxes_chosen" value="1" /><span data-i18n="ok"></span>
                </label>
              </div>
              <div class="item">
                <input class="numboxes" type="hidden" name="attr_numboxes" value="0" />
                <input class="checkbox squarebox" type="checkbox" name="attr_check_1" value="1" /><span></span><span
                  class="floatingbar boxesgeq2"></span>
                <input class="checkbox squarebox boxesgeq2" type="checkbox" name="attr_check_2" value="1" /><span
                  class="boxesgeq2"></span><span class="floatingbar boxesgeq3 boxesgeq2"></span>
                <input class="checkbox squarebox boxesgeq2 boxesgeq3" type="checkbox" name="attr_check_3"
                  value="1" /><span class="boxesgeq2 boxesgeq3"></span>
                <input class="itemname" type="text" spellcheck="false" name="attr_name"
                  data-i18n-placeholder="item_name" />
              </div>
              <div class="item-description">
                <input class="expand" type="checkbox" name="attr_expand" value="1" /><span></span>
                <textarea spellcheck="false" name="attr_description" data-i18n-placeholder="description"></textarea>
              </div>
            </div>
          </fieldset>
        </div>
      </div>
      <!-- Alchemicals-->
      <div class="col100 def-margin">
        <input class="title-checkbox" type="checkbox" name="attr_show_alchemicals" value="1" /><span
          class="label plainheader" data-i18n="alchemicals"></span>
        <div class="alchemicals free-repcontrol">
          <!--<div class="bandolier item"><span class="bandoliers-name" data-i18n="bandoliers"></span>
            <input class="checkbox squarebox" type="checkbox" name="attr_bandolier1_check_1" value="1"/><span></span><span class="floatingbar"></span>
            <input class="checkbox squarebox" type="checkbox" name="attr_bandolier1_check_2" value="1"/><span></span><span class="floatingbar"></span>
            <input class="checkbox squarebox" type="checkbox" name="attr_bandolier1_check_3" value="1"/><span></span>
            <input class="checkbox squarebox" type="checkbox" name="attr_bandolier2_check_1" value="1"/><span></span><span class="floatingbar"></span>
            <input class="checkbox squarebox" type="checkbox" name="attr_bandolier2_check_2" value="1"/><span></span><span class="floatingbar"></span>
            <input class="checkbox squarebox" type="checkbox" name="attr_bandolier2_check_3" value="1"/><span></span>
          </div>
          <div class="bandolier-desc" data-i18n="when_you_use_bandolier"></div>-->
          <fieldset class="repeating_alchemical">
            <input class="alchemicals-expand" type="checkbox" name="attr_expand" value="1" /><span></span>
            <div class="auto-expand"><span name="attr_name"></span>
              <textarea spellcheck="false" name="attr_name"></textarea>
            </div>
            <textarea class="alchemicals-info" spellcheck="false" name="attr_description"></textarea>
          </fieldset>
        </div>
      </div>
      <!-- Planning and Load-->
      <div class="col100 def-margin friends" style="background-color: white">
        <div class="specialheader col100 label flex" style="background-color: black; color: white">
          <span>Favor & Ire</span>
        </div>
        <div class="greyholder col100">
          <fieldset class="repeating_friend">
            <div class="friend-contact friend flex">
              <input class="friendstate" type="hidden" name="attr_status" value="0" />
              <label class="up">
                <input class="checkbox" type="checkbox" name="attr_status" value="up" /><span></span>
              </label>
              <label class="down">
                <input class="checkbox" type="checkbox" name="attr_status" value="down" /><span></span>
              </label>
              <div class="auto-expand"><span name="attr_name"></span>
                <textarea spellcheck="false" name="attr_name" data-i18n-placeholder="friend_name"></textarea>
              </div>
            </div>
            <input class="expand" type="checkbox" name="attr_null" value="1" /><span></span>
            <textarea class="description" spellcheck="false" name="attr_description"
              data-i18n-placeholder="notes"></textarea>
          </fieldset>
        </div>
      </div>
    </div>
    <!-- Action ratings-->
    <div class="col47 right-column actioncolumn small-margin">
      <div class="attribute col100">
        <div class="attribute-title flex col100">
          <button class="rollbutton label" type="roll" name="roll_insight"
            value="&{template:bitd} {{charname=@{character_name}}} {{resist=1}} {{subtitle=^{resists} @{consequence_query} ^{with}}} {{title=^{insight}}} @{insight_formula} {{charimage=@{chat_image}}}"
            data-i18n="insight" data-i18n-title="insight_description"></button>
          <input type="hidden" name="attr_insight" value="0" />
          <input type="hidden" name="attr_insight_formula"
            value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
          <input type="hidden" name="attr_insight_xp_max" value="6" />
          <div class="attribute-xp-box flex">
            <input class="tooth zero" type="radio" name="attr_insight_xp" value="0" checked="checked" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_insight_xp" value="1" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_insight_xp" value="2" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_insight_xp" value="3" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_insight_xp" value="4" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_insight_xp" value="5" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_insight_xp" value="6" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_insight_xp" value="7" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_insight_xp" value="8" /><span></span>
          </div>
        </div>
        <div class="actions col100">
          <div class="action flex col100">
            <input type="hidden" name="attr_hunt_formula"
              value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
            <input class="hidden fakeradio" type="checkbox" name="attr_hunt" value="0" checked="checked" />
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_hunt" value="1" /><span></span>
            <div class="divider"></div>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_hunt" value="2" /><span></span>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_hunt" value="3" /><span></span>

            <button class="rollbutton label" type="roll" name="roll_hunt"
              value="&{template:bitd} {{charname=@{character_name}}} {{action=1}} {{subtitle=^{rolls}}} {{title=^{hunt}}} {{@{position_query}}} {{effect=@{effect_query}}} @{hunt_formula} {{charimage=@{chat_image}}}"
              data-i18n="hunt" data-i18n-title="hunt_description"></button>
          </div>
          <div class="action flex col100">
            <input type="hidden" name="attr_study_formula"
              value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
            <input class="hidden fakeradio" type="checkbox" name="attr_study" value="0" checked="checked" />
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_study" value="1" /><span></span>
            <div class="divider"></div>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_study" value="2" /><span></span>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_study" value="3" /><span></span>
            <button class="rollbutton label" type="roll" name="roll_study"
              value="&{template:bitd} {{charname=@{character_name}}} {{action=1}} {{subtitle=^{rolls}}} {{title=^{study}}} {{@{position_query}}} {{effect=@{effect_query}}} @{study_formula} {{charimage=@{chat_image}}}"
              data-i18n="study" data-i18n-title="study_description"></button>
          </div>
          <div class="action flex col100">
            <input type="hidden" name="attr_survey_formula"
              value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
            <input class="hidden fakeradio" type="checkbox" name="attr_survey" value="0" checked="checked" />
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_survey" value="1" /><span></span>
            <div class="divider"></div>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_survey" value="2" /><span></span>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_survey" value="3" /><span></span>
            <button class="rollbutton label" type="roll" name="roll_survey"
              value="&{template:bitd} {{charname=@{character_name}}} {{action=1}} {{subtitle=^{rolls}}} {{title=^{survey}}} {{@{position_query}}} {{effect=@{effect_query}}} @{survey_formula} {{charimage=@{chat_image}}}"
              data-i18n="survey" data-i18n-title="survey_description"></button>
          </div>
          <div class="action flex col100">
            <input type="hidden" name="attr_tinker_formula"
              value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
            <input class="hidden fakeradio" type="checkbox" name="attr_tinker" value="0" checked="checked" />
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_tinker" value="1" /><span></span>
            <div class="divider"></div>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_tinker" value="2" /><span></span>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_tinker" value="3" /><span></span>
            <button class="rollbutton label" type="roll" name="roll_tinker"
              value="&{template:bitd} {{charname=@{character_name}}} {{action=1}} {{subtitle=^{rolls}}} {{title=^{tinker}}} {{@{position_query}}} {{effect=@{effect_query}}} @{tinker_formula} {{charimage=@{chat_image}}}"
              data-i18n="tinker" data-i18n-title="tinker_description"></button>
          </div>
        </div>
      </div>
      <div class="attribute col100">
        <div class="attribute-title flex col100">
          <button class="rollbutton label" type="roll" name="roll_prowess"
            value="&{template:bitd} {{charname=@{character_name}}} {{resist=1}} {{subtitle=^{resists} @{consequence_query} ^{with}}} {{title=^{prowess}}} @{prowess_formula} {{charimage=@{chat_image}}}"
            data-i18n="prowess" data-i18n-title="prowess_description"></button>
          <input type="hidden" name="attr_prowess" value="0" />
          <input type="hidden" name="attr_prowess_formula"
            value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
          <input type="hidden" name="attr_prowess_xp_max" value="6" />
          <div class="attribute-xp-box flex">
            <input class="tooth zero" type="radio" name="attr_prowess_xp" value="0" checked="checked" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_prowess_xp" value="1" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_prowess_xp" value="2" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_prowess_xp" value="3" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_prowess_xp" value="4" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_prowess_xp" value="5" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_prowess_xp" value="6" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_prowess_xp" value="7" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_prowess_xp" value="8" /><span></span>
          </div>
        </div>
        <div class="actions col100">
          <div class="action flex col100">
            <input type="hidden" name="attr_finesse_formula"
              value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
            <input class="hidden fakeradio" type="checkbox" name="attr_finesse" value="0" checked="checked" />
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_finesse" value="1" /><span></span>
            <div class="divider"></div>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_finesse" value="2" /><span></span>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_finesse" value="3" /><span></span>
            <button class="rollbutton label" type="roll" name="roll_finesse"
              value="&{template:bitd} {{charname=@{character_name}}} {{action=1}} {{subtitle=^{rolls}}} {{title=^{finesse}}} {{@{position_query}}} {{effect=@{effect_query}}} @{finesse_formula} {{charimage=@{chat_image}}}"
              data-i18n="finesse" data-i18n-title="finesse_description"></button>
          </div>
          <div class="action flex col100">
            <input type="hidden" name="attr_prowl_formula"
              value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
            <input class="hidden fakeradio" type="checkbox" name="attr_prowl" value="0" checked="checked" />
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_prowl" value="1" /><span></span>
            <div class="divider"></div>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_prowl" value="2" /><span></span>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_prowl" value="3" /><span></span>
            <button class="rollbutton label" type="roll" name="roll_prowl"
              value="&{template:bitd} {{charname=@{character_name}}} {{action=1}} {{subtitle=^{rolls}}} {{title=^{prowl}}} {{@{position_query}}} {{effect=@{effect_query}}} @{prowl_formula} {{charimage=@{chat_image}}}"
              data-i18n="prowl" data-i18n-title="prowl_description"></button>
          </div>
          <div class="action flex col100">
            <input type="hidden" name="attr_skirmish_formula"
              value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
            <input class="hidden fakeradio" type="checkbox" name="attr_skirmish" value="0" checked="checked" />
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_skirmish" value="1" /><span></span>
            <div class="divider"></div>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_skirmish" value="2" /><span></span>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_skirmish" value="3" /><span></span>
            <button class="rollbutton label" type="roll" name="roll_skirmish"
              value="&{template:bitd} {{charname=@{character_name}}} {{action=1}} {{subtitle=^{rolls}}} {{title=^{skirmish}}} {{@{position_query}}} {{effect=@{effect_query}}} @{skirmish_formula} {{charimage=@{chat_image}}}"
              data-i18n="skirmish" data-i18n-title="skirmish_description"></button>
          </div>
          <div class="action flex col100">
            <input type="hidden" name="attr_wreck_formula"
              value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
            <input class="hidden fakeradio" type="checkbox" name="attr_wreck" value="0" checked="checked" />
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_wreck" value="1" /><span></span>
            <div class="divider"></div>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_wreck" value="2" /><span></span>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_wreck" value="3" /><span></span>
            <button class="rollbutton label" type="roll" name="roll_wreck"
              value="&{template:bitd} {{charname=@{character_name}}} {{action=1}} {{subtitle=^{rolls}}} {{title=^{wreck}}} {{@{position_query}}} {{effect=@{effect_query}}} @{wreck_formula} {{charimage=@{chat_image}}}"
              data-i18n="wreck" data-i18n-title="wreck_description"></button>
          </div>
        </div>
      </div>
      <div class="attribute col100">
        <div class="attribute-title flex col100">
          <button class="rollbutton label" type="roll" name="roll_resolve"
            value="&{template:bitd} {{charname=@{character_name}}} {{resist=1}} {{subtitle=^{resists} @{consequence_query} ^{with}}} {{title=^{resolve}}} @{resolve_formula} {{charimage=@{chat_image}}}"
            data-i18n="resolve" data-i18n-title="resolve_description"></button>
          <input type="hidden" name="attr_resolve" value="0" />
          <input type="hidden" name="attr_resolve_formula"
            value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
          <input type="hidden" name="attr_resolve_xp_max" value="6" />
          <div class="attribute-xp-box flex">
            <input class="tooth zero" type="radio" name="attr_resolve_xp" value="0" checked="checked" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_resolve_xp" value="1" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_resolve_xp" value="2" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_resolve_xp" value="3" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_resolve_xp" value="4" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_resolve_xp" value="5" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_resolve_xp" value="6" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_resolve_xp" value="7" /><span></span>
            <input class="tooth xptooth" type="radio" name="attr_resolve_xp" value="8" /><span></span>
          </div>
        </div>
        <div class="actions col100">
          <div class="action flex col100">
            <input type="hidden" name="attr_attune_formula"
              value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
            <input class="hidden fakeradio" type="checkbox" name="attr_attune" value="0" checked="checked" />
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_attune" value="1" /><span></span>
            <div class="divider"></div>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_attune" value="2" /><span></span>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_attune" value="3" /><span></span>
            <button class="rollbutton label" type="roll" name="roll_attune"
              value="&{template:bitd} {{charname=@{character_name}}} {{action=1}} {{subtitle=^{rolls}}} {{title=^{attune}}} {{@{position_query}}} {{effect=@{effect_query}}} @{attune_formula} {{charimage=@{chat_image}}}"
              data-i18n="attune" data-i18n-title="attune_description"></button>
          </div>
          <div class="action flex col100">
            <input type="hidden" name="attr_command_formula"
              value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
            <input class="hidden fakeradio" type="checkbox" name="attr_command" value="0" checked="checked" />
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_command" value="1" /><span></span>
            <div class="divider"></div>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_command" value="2" /><span></span>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_command" value="3" /><span></span>
            <button class="rollbutton label" type="roll" name="roll_command"
              value="&{template:bitd} {{charname=@{character_name}}} {{action=1}} {{subtitle=^{rolls}}} {{title=^{command}}} {{@{position_query}}} {{effect=@{effect_query}}} @{command_formula} {{charimage=@{chat_image}}}"
              data-i18n="command" data-i18n-title="command_description"></button>
          </div>
          <div class="action flex col100">
            <input type="hidden" name="attr_consort_formula"
              value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
            <input class="hidden fakeradio" type="checkbox" name="attr_consort" value="0" checked="checked" />
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_consort" value="1" /><span></span>
            <div class="divider"></div>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_consort" value="2" /><span></span>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_consort" value="3" /><span></span>
            <button class="rollbutton label" type="roll" name="roll_consort"
              value="&{template:bitd} {{charname=@{character_name}}} {{action=1}} {{subtitle=^{rolls}}} {{title=^{consort}}} {{@{position_query}}} {{effect=@{effect_query}}} @{consort_formula} {{charimage=@{chat_image}}}"
              data-i18n="consort" data-i18n-title="consort_description"></button>
          </div>
          <div class="action flex col100">
            <input type="hidden" name="attr_sway_formula"
              value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
            <input class="hidden fakeradio" type="checkbox" name="attr_sway" value="0" checked="checked" />
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_sway" value="1" /><span></span>
            <div class="divider"></div>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_sway" value="2" /><span></span>
            <input class="checkbox circlebox fakeradio" type="checkbox" name="attr_sway" value="3" /><span></span>
            <button class="rollbutton label" type="roll" name="roll_sway"
              value="&{template:bitd} {{charname=@{character_name}}} {{action=1}} {{subtitle=^{rolls}}} {{title=^{sway}}} {{@{position_query}}} {{effect=@{effect_query}}} @{sway_formula} {{charimage=@{chat_image}}}"
              data-i18n="sway" data-i18n-title="sway_description"></button>
          </div>
        </div>
      </div>
      <!-- Cohort-->
      <input class="hider" type="hidden" name="attr_setting_show_cohort" value="0" />
      <div class="cohort">
        <input type="hidden" name="attr_char_cohort_verb" value="^{rolls_their}" />
        <input type="hidden" name="attr_char_cohort_roll_formula"
          value=" {{?{@{bonusdice}|0,zerodice=[[d6]]&amp;#44; [[d6]]|1,dice=[[d6]]|2,dice=[[d6]]&amp;#44; [[d6]]|3,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|4,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|5,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|6,dice=[[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]&amp;#44; [[d6]]|-1,zerodice=[[d6]]&amp;#44; [[d6]]|-2,zerodice=[[d6]]&amp;#44; [[d6]]|-3,zerodice=[[d6]]&amp;#44; [[d6]]}}}" />
        <div class="cohort-title flex col100 label">
          <input class="inherit" type="text" spellcheck="false" name="attr_char_cohort_name" value="Companion" />
          <button class="inherit rollbutton" type="roll" name="roll_char_cohort_roll"
            value="&{template:bitd} {{charname=@{character_name}}} {{resist=1}} {{short=1}} {{charname=@{char_cohort_name} (^{@{char_cohort_type}}, @{char_cohort_subtype})}} {{title=^{cohort_quality}}} {{subtitle=@{char_cohort_verb}}}) @{char_cohort_roll_formula} {{charimage=@{chat_image}}}"
            data-i18n="roll-inf"></button>
        </div>
        <div class="cohort-info flex col100 uppercase">
          <div class="cohort-dropdown">
            <div><span name="attr_char_cohort_type" data-i18n-dynamic="data-i18n-dynamic"></span></div>
            <div>
              <input type="radio" name="attr_char_cohort_type" value="gang" /><span data-i18n="gang"></span>
            </div>
            <div>
              <input type="radio" name="attr_char_cohort_type" value="elite" /><span data-i18n="elite"></span>
            </div>
            <div>
              <input type="radio" name="attr_char_cohort_type" value="expert" checked="checked" /><span
                data-i18n="expert"></span>
            </div>
          </div>
          <input class="sheet-inherit" type="text" spellcheck="false" name="attr_char_cohort_subtype"
            data-i18n-placeholder="hunter" />
          <div class="label cohort-quality-label" data-i18n="quality_abbreviated">Q:</div>
          <input class="label" type="number" name="attr_char_cohort_quality" min="0" max="5" value="1" />
        </div>
        <div class="cohort-condition flex col100">
          <label><span class="cohort-condition-name uppercase" data-i18n="weak"></span>
            <input class="tooth stresstooth" type="checkbox" name="attr_char_cohort_weak" value="1" /><span></span>
          </label>
          <label><span class="cohort-condition-name uppercase" data-i18n="impaired"></span>
            <input class="tooth stresstooth" type="checkbox" name="attr_char_cohort_impaired"
              value="1" /><span></span>
          </label>
          <label><span class="cohort-condition-name uppercase" data-i18n="broken"></span>
            <input class="tooth stresstooth" type="checkbox" name="attr_char_cohort_broken" value="1" /><span></span>
          </label>
          <label><span class="cohort-condition-name label" data-i18n="cohort_armor"></span>
            <input class="tooth stresstooth" type="checkbox" name="attr_char_cohort_armor" value="1" /><span></span>
          </label>
        </div>
        <label class="cohort-edgeflaw"><span class="uppercase" data-i18n="edges"></span>
          <div class="auto-expand"><span name="attr_char_cohort_edges"></span>
            <textarea spellcheck="false" name="attr_char_cohort_edges"></textarea>
          </div>
        </label>
        <label class="cohort-edgeflaw"><span class="uppercase" data-i18n="flaws"></span>
          <div class="auto-expand"><span name="attr_char_cohort_flaws"></span>
            <textarea spellcheck="false" name="attr_char_cohort_flaws"></textarea>
          </div>
        </label>
        <textarea class="cohort-description" spellcheck="false" name="attr_char_cohort_description"></textarea>
      </div>
      <!-- Bonus die box-->
      <div class="bonusdie col100">
        <div class="col100 label" data-i18n="bonus_die"></div>
        <div class="col100 flex">
          <div class="flex-center bonusdieplus">+</div>
          <div class="bonusdietext">
            <div class="label" data-i18n="push_yourself"></div><span data-i18n="push_yourself_desc"></span>
            <div class="label" data-i18n="devils_bargain"></div>
          </div>
        </div>
      </div>
      <!-- Friends-->

      <!-- Roll Fortune-->
      <button class="fortunebutton borderbutton" type="roll" name="roll_Fortune"
        value="&{template:bitd} {{charname=@{character_name}}} {{fortune=1}} {{subtitle=^{rolls}}} {{title=^{fortune}}} @{numberofdice} {{charimage=@{chat_image}}} {{notes=@{notes_query}}} "
        data-i18n="roll_fortune"></button>
    </div>
    <!-- Clocks-->
    <div class="col100 clocks def-margin free-repcontrol">
      <div class="specialheader label" data-i18n="clocks"></div>
      <fieldset class="repeating_clock">
        <input class="size" type="hidden" name="attr_size" value="" />
        <div class="auto-expand smallcaps"><span name="attr_name"></span>
          <textarea spellcheck="false" name="attr_name" data-i18n-placeholder="clock_name"></textarea>
        </div>
        <button class="broadcast-button" type="roll" name="roll_Show"
          value="&{template:bitd-broadcast} {{charname=@{character_name}}} {{title=@{name}}} {{clock=1}} {{clocksize=@{size}}} {{clockprogress=@{progress}}} {{charimage=@{chat_image}}}"
          data-i18n-title="send_details_to_chat">:</button>
        <div class="size-choice">
          <label class="text-button">
            <input type="radio" name="attr_size" value="4" /><span>4</span>
          </label>
          <label class="text-button">
            <input type="radio" name="attr_size" value="6" /><span>6</span>
          </label>
          <label class="text-button">
            <input type="radio" name="attr_size" value="8" /><span>8</span>
          </label>
          <label class="text-button">
            <input type="radio" name="attr_size" value="10" /><span>10</span>
          </label>
          <label class="text-button">
            <input type="radio" name="attr_size" value="12" /><span>12</span>
          </label>
        </div>
        <div class="clock-container">
          <div class="spoke-0 all"></div>
          <div class="spoke-30 sheet-12clock"></div>
          <div class="spoke-45 sheet-8clock"></div>
          <div class="spoke-36 sheet-10clock"></div>
          <div class="spoke-60 sheet-6clock sheet-12clock"></div>
          <div class="spoke-72 sheet-10clock"></div>
          <div class="spoke-90 sheet-4clock sheet-8clock sheet-12clock"></div>
          <div class="spoke-108 sheet-10clock"></div>
          <div class="spoke-120 sheet-6clock sheet-12clock"></div>
          <div class="spoke-135 sheet-8clock"></div>
          <div class="spoke-144 sheet-10clock"></div>
          <div class="spoke-150 sheet-12clock"></div>
          <input class="zero input-progress" type="radio" name="attr_progress" value="0"
            checked="checked" /><span></span>
          <input class="input-progress all" type="radio" name="attr_progress" value="1" />
          <input class="input-progress all" type="radio" name="attr_progress" value="2" />
          <input class="input-progress all" type="radio" name="attr_progress" value="3" />
          <input class="input-progress all" type="radio" name="attr_progress" value="4" />
          <input class="input-progress sheet-6clock sheet-8clock sheet-10clock sheet-12clock" type="radio"
            name="attr_progress" value="5" />
          <input class="input-progress sheet-6clock sheet-8clock sheet-10clock sheet-12clock" type="radio"
            name="attr_progress" value="6" />
          <input class="input-progress sheet-8clock sheet-10clock sheet-12clock" type="radio" name="attr_progress"
            value="7" />
          <input class="input-progress sheet-8clock sheet-10clock sheet-12clock" type="radio" name="attr_progress"
            value="8" />
          <input class="input-progress sheet-10clock sheet-12clock" type="radio" name="attr_progress" value="9" />
          <input class="input-progress sheet-10clock sheet-12clock" type="radio" name="attr_progress" value="10" />
          <input class="input-progress sheet-12clock" type="radio" name="attr_progress" value="11" />
          <input class="input-progress sheet-12clock" type="radio" name="attr_progress" value="12" />
          <div class="clock"></div>
        </div>
      </fieldset>
    </div>
    <textarea class="notes" spellcheck="false" name="attr_notes" data-i18n-placeholder="notes"></textarea>
  </div>
</div>
<!-- Crew Sheet-->

<rolltemplate class="sheet-rolltemplate-bitd">
  <div
    class="holder{{#action}} action{{/action}}{{#resist}} resist{{/resist}}{{#vice}} vice{{/vice}}{{#fortune}} fortune{{/fortune}}{{#short}} short{{/short}}{{#action}}{{^position}} short{{/position}}{{/action}}">
    {{#charimage}}
    <div class="char-image">[Image]({{charimage}})</div>{{/charimage}}
    <div class="header{{#charimage}} narrow{{/charimage}}">{{charname}} {{subtitle}}</div>
    <div class="title"><span class="{{#small-title}}small-title{{/small-title}}">{{title}}</span></div>
    <div class="dice">{{^zerodice}}{{dice}}{{/zerodice}}{{#zerodice}}
      <div class="zerodice1">{{zerodice}}</div>
      <div class="zerodice2" data-i18n="zerodice"></div>{{/zerodice}}
    </div>{{#position}}
    <div class="position">{{position}}</div>{{/position}}{{#effect}}
    <div class="effect">{{effect}}</div>{{/effect}}{{#resist}}{{^short}}
    <div class="instructions" data-i18n="resist_instructions"></div>{{/short}}{{/resist}}{{#vice}}{{^short}}
    <div class="instructions" data-i18n="vice_instructions"></div>{{/short}}{{/vice}}{{#notes}}
    <div class="notes">{{notes}}</div>{{/notes}}
  </div>
</rolltemplate>
<rolltemplate class="sheet-rolltemplate-bitd-broadcast">
  <div>{{#charimage}}{{^clock}}
    <div class="char-image">[Image]({{charimage}})</div>{{/clock}}{{/charimage}}
    <div class="header{{#charimage}}{{^clock}} narrow{{/clock}}{{/charimage}}">
      <div>{{charname}}</div>
      <div>{{type}}</div>
    </div>{{#content}}
    <div class="title">{{title}}</div>
    <div class="content">{{content}}</div>{{/content}}{{#clock}}
    <div class="flex">
      <div class="clock size-{{clocksize}} progress-{{clockprogress}}">
        <div class="spoke-0"></div>
        <div class="spoke-30"></div>
        <div class="spoke-36"></div>
        <div class="spoke-45"></div>
        <div class="spoke-60"></div>
        <div class="spoke-72"></div>
        <div class="spoke-90"></div>
        <div class="spoke-108"></div>
        <div class="spoke-135"></div>
        <div class="spoke-144"></div>
        <div class="spoke-120"></div>
        <div class="spoke-150"></div>
      </div>
      <div class="title">{{title}}</div>
    </div>{{/clock}}{{#harm}}
    <div class="title" data-i18n="harm"></div>
    <table class="harm">
      <tr>
        <td>3</td>
        <td>
          <div class="harm-inner">{{harm3}}</div>
        </td>
        <td data-i18n="need_help"></td>
      </tr>
      <tr>
        <td>2</td>
        <td>{{#harm2_1}}
          <div class="harm-inner">{{harm2_1}}</div>{{/harm2_1}}{{#harm2_2}}
          <div class="harm-inner">{{harm2_2}}</div>{{/harm2_2}}
        </td>
        <td data-i18n="minus1d"></td>
      </tr>
      <tr>
        <td>1</td>
        <td>{{#harm1_1}}
          <div class="harm-inner">{{harm1_1}}</div>{{/harm1_1}}{{#harm1_2}}
          <div class="harm-inner">{{harm1_2}}</div>{{/harm1_2}}
        </td>
        <td data-i18n="less_effect"></td>
      </tr>
    </table>{{/harm}}
  </div>
</rolltemplate>
<script type="text/worker">
"use strict";
const data = {
"crew": {
},
"playbook": {
},
"factions": {
},
"actions": {
  "insight": ["hunt", "study", "survey", "tinker"],
  "prowess": ["finesse", "prowl", "skirmish", "wreck"],
  "resolve": ["attune", "command", "consort", "sway"]
},
"traumas": ["cold", "haunted", "obsessed", "paranoid", "reckless", "soft", "unstable", "vicious"],
"items": [],
"translatedDefaults": {
  "cohort1_name": "cohort",
  "contacts_title": "contacts",
  "factions_title": "factions_title",
  "factions1_header": "factions1",
  "factions2_header": "factions2",
  "factions3_header": "factions3",
  "factions4_header": "factions4",
  "factions5_header": "factions5",
  "friends_title": "friends",
  "upgrade_20_name": "insight",
  "upgrade_20_description": "upgrade_insight_description",
  "upgrade_21_name": "prowess",
  "upgrade_21_description": "upgrade_prowess_description",
  "upgrade_22_name": "resolve",
  "upgrade_22_description": "upgrade_resolve_description",
  "upgrade_23_name": "personal",
  "upgrade_23_description": "upgrade_personal_description",
  "upgrade_24_name": "mastery",
  "upgrade_24_description": "upgrade_mastery_description",
      "xp_condition1": "xp_good",
  "xp_condition2": "xp_discover",
  "xp_condition3": "xp_beliefs",
      "xp_condition4": "xp_moment",
      "xp_extra1": "xp_custom",
      "xp_extra2": "xp_custom",
      "xp_extra3": "xp_custom"
},
"defaultValues": {
  "attune": "0",
  "command": "0",
  "consort": "0",
  "finesse": "0",
  "hunt": "0",
  "prowl": "0",
  "skirmish": "0",
  "study": "0",
  "survey": "0",
  "sway": "0",
  "tinker": "0",
  "wreck": "0"
},
"maxFriendsPerPlaybook": 5,
"maxContactsPerCrew": 6,
"friendlessPlaybooks": [],
"translatedCrewAttributes": ["crew_description", "crew_xp_condition"],
"translatedPlaybookAttributes": ["friends_title", "gatherinfo1", "gatherinfo2", "gatherinfo3", "gatherinfo4", "gatherinfo5", "gatherinfo6", "playbook_description","xp_condition"]
};
/* global data, getTranslationByKey, getAttrs, setAttrs, on, getSectionIDs, generateRowID, removeRepeatingRow */
const sheetVersion = "1.0";
const sheetName = "Blades in the Dark";
const getTranslation = (key) => (getTranslationByKey(key) || "NO_TRANSLATION_FOUND");
/* It's necessary to include the base data at the start of the file */
/* Translate all the data */
Object.keys(data.crew).forEach(crew => {
const base = data.crew[crew].base;
Object.keys(base).forEach(attr => {
  if (data.translatedCrewAttributes.includes(attr)) {
    base[attr] = getTranslation(base[attr]);
  }
});
/* Generate crew contacts from translation file */
data.crew[crew].contact = [...Array(data.maxContactsPerCrew).keys()].map(i => ({
  name: getTranslation(`crew_${crew}_contact_${i}`)
}));
data.crew[crew].crewability = data.crew[crew].crewability.map(name => ({
  name: getTranslation(`crew_ability_${name}`),
  description: getTranslation(`crew_ability_${name}_description`)
}));
data.crew[crew].upgrade.forEach(upgrade => {
  upgrade.name = getTranslation(upgrade.name);
  if (upgrade.description) {
    upgrade.description = getTranslationByKey(upgrade.description) || "";
  }
  upgrade.boxes_chosen = "1";
});
});
data.items.forEach(item => {
item.boxes_chosen = "1";
item.name = getTranslation(item.name);
item.description = getTranslationByKey(item.description) || "";
});
Object.keys(data.translatedDefaults).forEach(k => {
data.translatedDefaults[k] = getTranslation(data.translatedDefaults[k]);
});
Object.assign(data.defaultValues, data.translatedDefaults);
Object.keys(data.factions).forEach(x => {
data.factions[x].forEach(faction => {
  faction.name = getTranslation(faction.name);
});
});
Object.keys(data.playbook).forEach(playbook => {
const base = data.playbook[playbook].base;
Object.keys(base).forEach(attr => {
  if (data.translatedPlaybookAttributes.includes(attr)) {
    base[attr] = getTranslation(base[attr]);
  }
});
/* Generate playbook friends from translation file */
if (!data.friendlessPlaybooks.includes(playbook)) {
  data.playbook[playbook].friend = [...Array(data.maxFriendsPerPlaybook).keys()]
    .map(i => ({
      name: getTranslation(`playbook_${playbook}_friend_${i}`)
    }))
    .filter(o => o.name);
}
else data.playbook[playbook].friend = [];
data.playbook[playbook].ability = data.playbook[playbook].ability.map(name => ({
  name: getTranslation(`playbook_ability_${name}`),
  description: getTranslation(`playbook_ability_${name}_description`)
}));
data.playbook[playbook].playbookitem.forEach(item => {
  item.name = getTranslation(item.name);
  if (item.description) {
    item.description = getTranslationByKey(item.description) || "";
  }
  item.boxes_chosen = "1";
});
});
const playbookAbilityMap = new Map([...Object.values(data.playbook).map(x => x.ability).reduce((m, v) => {
v.forEach(a => m.add(a));
return m;
}, new Set())].map(x => {
return [x.name.toLowerCase(), x.description];
}));
const crewAbilityMap = new Map([...Object.values(data.crew).map(x => x.crewability).reduce((m, v) => {
v.forEach(a => m.add(a));
return m;
}, new Set())].map(x => {
return [x.name.toLowerCase(), x.description];
}));
/* Utility functions - shouldn't need to touch most of these */
const mySetAttrs = (attrs, options, callback) => {
  const finalAttrs = Object.keys(attrs).reduce((m, k) => {
    m[k] = `${attrs[k]}`;
    return m;
  }, {});
  setAttrs(finalAttrs, options, callback);
},
setAttr = (name, value) => {
  getAttrs([name], v => {
    const setting = {};
    if (v[name] !== `${value}`) setting[name] = `${value}`;
    setAttrs(setting);
  });
},
fillRepeatingSectionFromData = (sectionName, dataList, autogen, callback) => {
  callback = callback || (() => {});
  getSectionIDs(`repeating_${sectionName}`, idList => {
    const existingRowAttributes = [
      ...idList.map(id => `repeating_${sectionName}_${id}_name`),
      ...idList.map(id => `repeating_${sectionName}_${id}_autogen`)
    ];
    getAttrs(existingRowAttributes, v => {
      /* Delete auto-generated rows */
      if (autogen) {
        idList = idList.filter(id => {
          if (v[`repeating_${sectionName}_${id}_autogen`]) {
            removeRepeatingRow(`repeating_${sectionName}_${id}`);
            return false;
          }
          else return true;
        });
      }
      const existingRowNames = idList.map(id => v[`repeating_${sectionName}_${id}_name`]),
        createdIDs = [],
        setting = dataList.filter(o => !existingRowNames.includes(o.name))
          .map(o => {
            let rowID;
            while (!rowID) {
              let newID = generateRowID();
              if (!createdIDs.includes(newID)) {
                rowID = newID;
                createdIDs.push(rowID);
              }
            }
            const newAttrs = {};
            if (autogen) {
              newAttrs[`repeating_${sectionName}_${rowID}_autogen`] = "1";
            }
            return Object.keys(o).reduce((m, key) => {
              m[`repeating_${sectionName}_${rowID}_${key}`] = o[key];
              return m;
            }, newAttrs);
          })
          .reduce((m, o) => Object.assign(m, o), {});
      mySetAttrs(setting, {}, callback);
    });
  });
},
diceMagic = num => {
  const range = end => [...Array(end + 1).keys()].slice(1);
  if (num > 0) return `dice=${range(num).map(() => "[[d6]]").join("&"+"#44"+"; ")}`;
  else return "zerodice=[[d6]]&"+"#44"+"; [[d6]]";
},
buildRollFormula = base => {
  return ` {{?{@{bonusdice}|${
    [0, 1, 2, 3, 4, 5, 6, -1, -2, -3].map(n => `${n},${diceMagic(n + (parseInt(base) || 0))}`).join("|")
  }}}}`;
},
buildNumdiceFormula = () => {
  return ` {{?{${getTranslation("numberofdice")}|${
    [0, 1, 2, 3, 4, 5, 6].map(n => `${n},${diceMagic(n)}`).join("|")
  }}}}`;
},
emptyFirstRowIfUnnamed = sectionName => {
  getSectionIDs(`repeating_${sectionName}`, idList => {
    const id = idList[0];
    getAttrs([`repeating_${sectionName}_${id}_name`], v => {
      if (!v[`repeating_${sectionName}_${id}_name`]) {
        removeRepeatingRow(`repeating_${sectionName}_${id}`);
      }
    });
  });
},
handleBoxesFill = (name, upToFour) => {
  on(`change:${name}1 change:${name}2 change:${name}3 change:${name}4`, event => {
    if (event.sourceType !== "player") return;
    getAttrs([event.sourceAttribute], v => {
      const rName = event.sourceAttribute.slice(0, -1),
        setting = {};
      if (String(v[event.sourceAttribute]) === "1") {
        switch (event.sourceAttribute.slice(-1)) {
        case "4":
          setting[`${rName}3`] = 1;
          /* falls through */
        case "3":
          setting[`${rName}2`] = 1;
          /* falls through */
        case "2":
          setting[`${rName}1`] = 1;
        }
      }
      if (String(v[event.sourceAttribute]) === "0") {
        switch (event.sourceAttribute.slice(-1)) {
        case "1":
          setting[`${rName}2`] = 0;
          /* falls through */
        case "2":
          setting[`${rName}3`] = 0;
          /* falls through */
        case "3":
          if (upToFour) setting[`${rName}4`] = 0;
        }
      }
      mySetAttrs(setting);
    });
  });
},
calculateResistance = name => {
  getAttrs([...data.actions[name], `setting_resbonus_${name}`], v => {
    const total = data.actions[name].map(x => v[x])
      .reduce((s, c) => s + (`${c}` === "0" ? 0 : 1), 0);
    setAttr(name, total);
    setAttr(`${name}_formula`, buildRollFormula(total + parseInt(v[`setting_resbonus_${name}`])));
  });
},
calculateVice = () => {
  getAttrs(Object.keys(data.actions), v => {
    const total = Math.min(...Object.keys(v).map(x => parseInt(v[x]) || 0));
    setAttr("vice_formula", buildRollFormula(total));
  });
},
calculateStashFormula = () => getAttrs(["stash"], v => {
  setAttr("stash_formula", buildRollFormula(Math.floor(parseInt(v.stash) / 10)));
}),
calculateWantedFormula = () => getAttrs(["wanted"], v => {
  setAttr("wanted_formula", buildRollFormula(v.wanted));
}),
calculateCohortDice = prefixes => {
  const sourceAttrs = [
    "crew_tier",
    ...prefixes.map(p => `${p}_impaired`),
    ...prefixes.map(p => `${p}_type`),
    ...prefixes.map(p => `${p}_roll_formula`),
  ];
  getAttrs(sourceAttrs, v => {
    const setting = {};
    prefixes.forEach(prefix => {
      const dice = (parseInt(v.crew_tier) || 0) - (parseInt(v[`${prefix}_impaired`]) || 0) +
          ((v[`${prefix}_type`] === "elite" || v[`${prefix}_type`] === "expert") ? 1 : 0),
        formula = buildRollFormula(dice);
      if (formula !== v[`${prefix}_roll_formula`]) setting[`${prefix}_roll_formula`] = formula;
    });
    setAttrs(setting);
  });
};
/* CONSTANTS */
const crewAttributes = [...new Set([].concat(...Object.keys(data.crew).map(x => Object.keys(data.crew[x].base))))],
playbookAttributes = [...new Set([].concat(...Object.keys(data.playbook).map(x => Object.keys(data.playbook[x].base))))],
watchedAttributes = new Set(crewAttributes.concat(playbookAttributes)),
actionsFlat = [].concat(...Object.keys(data.actions).map(x => data.actions[x])),
autoExpandFields = [
  "repeating_ability:name",
  "repeating_ability:description",
  "repeating_crewability:name",
  "repeating_crewability:description",
  "repeating_playbookitem:name",
  "repeating_upgrade:name",
  "repeating_friend:name",
  "repeating_contact:name",
  "repeating_clock:name",
  "repeating_crewclock:name",
  "repeating_factionclock:name",
  "repeating_cohort:edges",
  "repeating_cohort:flaws",
  "repeating_alchemical:name",
  "xp_condition",
  "xp_condition_extra",
  "xp_condition2",
  "xp_condition3",
  "crew_xp_condition",
  "hunting_grounds_type",
  "hunting_grounds_description",
  "cohort1_edges",
  "cohort1_flaws",
  "heritage",
  "background",
  "vice_purveyor",
],
autogenSections = [
  "ability",
  "crewability",
  "friend",
  "contact",
  "playbookitem",
  "upgrade"
],
translatedNames = [...Object.keys(data.playbook), ...Object.keys(data.crew)].reduce((m, keyName) => {
  if (getTranslationByKey(keyName)) m[getTranslationByKey(keyName).toLowerCase()] = keyName;
  else m[keyName.toLowerCase()] = keyName;
  return m;
}, {});
/* EVENT HANDLERS */
/* Set default fields when setting crew type or playbook */
on("change:crew_type change:playbook", event => {
getAttrs(["playbook", "crew_type", "changed_attributes", "setting_autofill", ...watchedAttributes], v => {
  const changedAttributes = (v.changed_attributes || "").split(","),
    sourceName = translatedNames[(event.sourceAttribute === "crew_type" ? v.crew_type : v.playbook).toLowerCase()],
    fillBaseData = (inputData, defaultAttrNames) => {
      if (data) {
        const finalSettings = defaultAttrNames.filter(name => !changedAttributes.includes(name))
          // do not reset attributes which have been changed by the user
          .filter(name => v[name] !== (data.defaultValues[name] || ""))
          // do not set attributes if current value is equal to sheet defaults
          .reduce((m, name) => {
            m[name] = data.defaultValues[name] || "";
            return m;
          }, {});
        Object.keys(inputData).filter(name => !changedAttributes.includes(name))
          .forEach(name => (finalSettings[name] = inputData[name]));
        mySetAttrs(finalSettings);
      }
    };
  if (event.sourceAttribute === "crew_type" ? v.crew_type : v.playbook) {
    setAttr("show_playbook_reminder", "0");
  }
  if (v.setting_autofill !== "1") return;
  if (event.sourceAttribute === "crew_type" && sourceName in data.crew) {
    fillRepeatingSectionFromData("contact", data.crew[sourceName].contact, true);
    fillRepeatingSectionFromData("crewability", data.crew[sourceName].crewability, true);
    fillRepeatingSectionFromData("upgrade", data.crew[sourceName].upgrade, true);
    fillBaseData(data.crew[sourceName].base, crewAttributes);
  }
  if (event.sourceAttribute === "playbook" && sourceName in data.playbook) {
    fillRepeatingSectionFromData("friend", data.playbook[sourceName].friend, true);
    fillRepeatingSectionFromData("ability", data.playbook[sourceName].ability, true);
    fillRepeatingSectionFromData("playbookitem", data.playbook[sourceName].playbookitem, true);
    fillBaseData(data.playbook[sourceName].base, playbookAttributes);
  }
});
});
const fillPlaybookAbility = () => {
const prefix = "repeating_ability";
getAttrs([`${prefix}_name`, `${prefix}_description`], v => {
  if (!v[`${prefix}_description`]) {
    const description = playbookAbilityMap.get((v[`${prefix}_name`] || "").toLowerCase());
    if (description) setAttr(`${prefix}_description`, description);
  }
});
};
const fillCrewAbility = () => {
const prefix = "repeating_crewability";
getAttrs([`${prefix}_name`, `${prefix}_description`], v => {
  if (!v[`${prefix}_description`]) {
    const description = crewAbilityMap.get((v[`${prefix}_name`] || "").toLowerCase());
    if (description) setAttr(`${prefix}_description`, description);
  }
});
};
on("change:repeating_ability:name", fillPlaybookAbility);
on("change:repeating_crewability:name", fillCrewAbility);
/* Watch repeating rows for changes and set autogen to false if change happens */
autogenSections.forEach(sectionName => {
on(`change:repeating_${sectionName}`, event => {
  getAttrs([`repeating_${sectionName}_autogen`], v => {
    if (v[`repeating_${sectionName}_autogen`] && event.sourceType === "player") {
      setAttr(`repeating_${sectionName}_autogen`, "");
    }
  });
});
});
/* Watch for changes in auto-set attributes and update changed_attributes*/
watchedAttributes.forEach(name => {
on(`change:${name}`, event => {
  if (event.sourceType === "player") {
    getAttrs(["changed_attributes"], v => {
      const changedAttributes = [...new Set(v.changed_attributes.split(",")).add(name)]
        .filter(x => !!x).join(",");
      setAttr("changed_attributes", changedAttributes);
    });
  }
});
});
/* Register attribute/action event handlers */
Object.keys(data.actions).forEach(attrName => {
on([...data.actions[attrName], `setting_resbonus_${attrName}`]
  .map(x => `change:${x}`).join(" "), () => calculateResistance(attrName)
);
on(`change:${attrName}`, calculateVice);
});
/* Calculate stash */
on("change:stash", calculateStashFormula);
on("change:wanted", calculateWantedFormula);
/* Calculate trauma */
on(data.traumas.map(x => `change:trauma_${x}`).join(" "), event => {
getAttrs(data.traumas.map(x => `trauma_${x}`), v => {
  if (event.sourceType === "player") {
    const newTrauma = data.traumas.reduce((m, name) => m + (parseInt(v[`trauma_${name}`]) || 0), 0);
    setAttr("trauma", newTrauma);
  }
});
});
/* Generate buttons */
on("change:generate_factions", () => {
setAttr("show_faction_generatebutton", "0");
Object.keys(data.factions).forEach(sectionName => {
  fillRepeatingSectionFromData(sectionName, data.factions[sectionName]);
});
});
autogenSections.forEach(sectionName => {
on(`change:generate_${sectionName}`, () => {
  getAttrs(["generate_source_character", "generate_source_crew", "sheet_type"], v => {
    const dataVar = (v.sheet_type === "character") ? data.playbook : data.crew,
      genSource = v[`generate_source_${v.sheet_type}`];
    if (genSource in dataVar) {
      emptyFirstRowIfUnnamed(sectionName);
      fillRepeatingSectionFromData(sectionName, dataVar[genSource][sectionName]);
    }
  });
});
});
/* Extra stress and trauma */
on("change:setting_extra_stress", event => setAttr("stress_max", 7 + (parseInt(event.newValue) || 0)));
on("change:setting_extra_trauma", event => setAttr("trauma_max", 3 + (parseInt(event.newValue) || 0)));
/* Calculate cohort quality */
on(["crew_tier", "cohort1_impaired", "cohort1_type"].map(x => `change:${x}`).join(" "), () => calculateCohortDice(["cohort1"]));
on("change:repeating_cohort", () => calculateCohortDice(["repeating_cohort"]));
on("change:crew_tier", () => {
getSectionIDs("repeating_cohort", a => calculateCohortDice(a.map(id => `repeating_cohort_${id}`)));
});
on("change:char_cohort_quality change:char_cohort_impaired change:setting_show_cohort", () => {
getAttrs(["char_cohort_quality", "char_cohort_impaired"], v => {
  const dice = (parseInt(v.char_cohort_quality) || 0) - (parseInt(v.char_cohort_impaired) || 0);
  setAttr("char_cohort_roll_formula", buildRollFormula(dice));
});
});
/* Set correct verb for cohort roll button */
["char_cohort", "cohort1", "repeating_cohort"].forEach(prefix => {
const eventString = "change:" + ((prefix === "repeating_cohort") ? `${prefix}:type` : `${prefix}_type`);
on(eventString, event => {
  const verb = (event.newValue === "expert") ? "^{rolls_their}" : "^{roll_their}";
  setAttr(`${prefix}_verb`, verb);
});
});
/* Left-fill checkboxes */
handleBoxesFill("upgrade_24_check_", true);
handleBoxesFill("bandolier1_check_");
handleBoxesFill("bandolier2_check_");
["item", "playbookitem", "upgrade"].forEach(sName => handleBoxesFill(`repeating_${sName}:check_`));
/* Pseudo-radios */
["crew_tier", ...actionsFlat].forEach(name => {
on(`change:${name}`, event => {
  if (String(event.newValue) === "0" && event.sourceType === "player") {
    setAttr(name, (parseInt(event.previousValue) || 1) - 1);
  }
  setAttr(`${name}_formula`, buildRollFormula(event.newValue || "0"));
});
});
/* Item reset button */
on("change:reset_items", () => {
const clearChecks = sectionName => {
  getSectionIDs(`repeating_${sectionName}`, idArray => {
    const setting = [
      ...idArray.map(id => `repeating_${sectionName}_${id}_check_1`),
      ...idArray.map(id => `repeating_${sectionName}_${id}_check_2`),
      ...idArray.map(id => `repeating_${sectionName}_${id}_check_3`)
    ].reduce((m, name) => {
      m[name] = 0;
      return m;
    }, {});
    mySetAttrs(setting);
  });
};
setAttr("load", 0);
["item", "playbookitem"].forEach(clearChecks);
});
/* Default values for number of upgrades boxes — probably not necessary anymore */
// on('change:repeating_upgrade:boxes_chosen', () => {
// 	getAttrs(['repeating_upgrade_numboxes'], v => {
// 		if (!['1', '2', '3'].includes(v.repeating_upgrade_numboxes)) {
// 			setAttr('repeating_upgrade_numboxes', '1');
// 		}
// 	});
// });
/* Resistance query */
on("change:setting_consequence_query sheet:opened", () => {
getAttrs(["setting_consequence_query"], v => {
  const consequenceQuery = (String(v.setting_consequence_query) === "1") ?
    `?{${getTranslation("consequence")}|${getTranslation("a_consequence")}}` :
    "^{a_consequence}";
  setAttr("consequence_query", consequenceQuery);
});
});
/* Trim whitespace in auto-expand fields */
autoExpandFields.forEach(name => {
on(`change:${name}`, event => {
  const attrName = name.replace(":", "_");
  getAttrs([attrName], v => {
    if (v[attrName].trim() !== v[attrName] && event.sourceType === "player") {
      setAttr(attrName, v[attrName].trim());
    }
  });
});
});
/* Clean chat image URL */
on("change:chat_image", event => {
const match = (event.newValue || "").match(/^(https:\/\/s3\.amazonaws\.com\/files\.d20\.io\/images\/.*\.jpg)\?\d+$/);
if (match) setAttr("chat_image", match[1]);
});
/* Number of dice prompt */
on("sheet:opened", () => {
/* Set up translated attributes */
const translatedAttrs = {
  bonusdice: getTranslation("bonusdice"),
  effect_query: getTranslation("effect_query"),
  notes_query: `?{${getTranslation("notes")}}`,
  numberofdice: buildNumdiceFormula(),
  position_query: `?{${getTranslation("position")}|` +
    `${getTranslation("risky")},position=${getTranslation("risky")}|` +
    `${getTranslation("controlled")},position=${getTranslation("controlled")}|` +
    `${getTranslation("desperate")},position=${getTranslation("desperate")}|` +
    `${getTranslation("fortune_roll")},position=}`,
};
getAttrs(Object.keys(translatedAttrs), v => {
  const setting = {};
  Object.keys(translatedAttrs).forEach(name => {
    if (v[name] !== translatedAttrs[name]) setting[name] = translatedAttrs[name];
  });
  mySetAttrs(setting);
});
});
/* INITIALISATION AND UPGRADES */
on("sheet:opened", () => {
getAttrs(["sheet_type", "changed_attributes", "crew_type", "playbook"], v => {
  /* Make sure sheet_type is never 0 */
  if (!["crew", "faction"].includes(v.sheet_type)) setAttr("sheet_type", "character");
  /* Remove reminder box if we have playbook or crew name */
  if (v.playbook || v.crew_type) setAttr("show_playbook_reminder", "0");
});
/* Setup and upgrades */
getAttrs(["version"], v => {
  const upgradeSheet = version => {
      // const [major, minor] = version && version.split(".").map(x => parseInt(x));
      console.log(`Found version ${version}.`);
    },
    initialiseSheet = () => {
      const setting = ["ability", "friend", "crewability", "contact", "playbookitem", "upgrade", "framefeature"]
        .reduce((memo, sectionName) => {
          memo[`repeating_${sectionName}_${generateRowID()}_autogen`] = 1;
          return memo;
        }, {});
      mySetAttrs(setting);
      fillRepeatingSectionFromData("item", data.items);
      /* Set translated default values */
      getAttrs(Object.keys(data.translatedDefaults), v => {
        const setting = {};
        Object.keys(data.translatedDefaults).forEach(k => {
          if (v[k] !== data.translatedDefaults[k]) setting[k] = data.translatedDefaults[k];
        });
        mySetAttrs(setting);
      });
      console.log("Initialising new sheet.");
    };
  if (v.version) upgradeSheet(v.version);
  else initialiseSheet();
  // Set version number
  mySetAttrs({
    version: sheetVersion,
    character_sheet: `${sheetName} v${sheetVersion}`,
  });
});
});
</script>